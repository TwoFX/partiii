We need to show the following things.
\begin{enumerate}
	\item If $\varphi\colon A\to B$ is a ring homomorphism, we obtain an
		induced morphism
		\[ (f, f^\#)\colon (\Spec B, \mathcal{O}_B)\to (\Spec A, \mathcal{O}_A). \]
	\item Any morphism of affine schemes as locally ringed spaces arises in
		this way.
\end{enumerate}

For the first part, let $\varphi\colon A\to B$ be a ring homomorphism and define
\begin{align*}
	f\colon \Spec B&\to \Spec A\\
	p&\mapsto \varphi^{-1}(p),
\end{align*}
where we use that $\varphi^{-1}(p)$ is prime: if $ab \in \varphi^{-1}(p)$, then
$\varphi(ab) = \varphi(a)\varphi(b) \in p$. Hence $\varphi(a) \in p$ or
$\varphi(b) \in p$, hence $a \in \varphi^{-1}(p)$ or $b \in \varphi^{-1}(p)$.

We also need to show that $f$ is continuous. Any closed set is of the form
$V(I)$. We calculate
\begin{align*}
	f^{-1}(V(I)) &= f^{-1}(\set{p \in \Spec A\given p\supseteq I})\\
	&= \set{q \in \Spec B\given f(q) \supseteq I}\\
	&= \set{q \in \Spec B\given \varphi^{-1}(q)\supseteq I}\\
	&= \set{q \in \Spec B\given q\supseteq \varphi(I)}\\
	&= V(\varphi(I)).
\end{align*}
Hence the preimage of a closed set is closed, so $f$ is continuous.

We need to construct a morphism of sheaves
\[ f_\#\colon \mathcal{O}_{\Spec A} \to f_*\mathcal{O}_{\Spec B}. \]
For $p \in \Spec B$, we obtain a natural homomorphism
\begin{align*}
	\varphi_p\colon A_{\varphi^{-1}(p)}&\to B_p\\
	\frac{a}{s}&\mapsto \frac{\varphi(a)}{\varphi(s)},
\end{align*}
where $a \in A$, $s\notin \varphi^{-1}(p)$. This makes sense since $\varphi(a) \in B$
and $\varphi(s)\notin p$.

The maximal ideal $pB_p$ of $B_p$ is generated by the image of $p$ under the map
$B\to B_p$. The maximal ideal $\varphi^{-1}(p)A_{\varphi^{-1}(p)}$ of $A_{\varphi^{-1}(p)}$ is generated by the image
of $\varphi^{-1}(p)$ under the map $A\to A_p$.

We have a commutative diagram
\[\begin{tikzcd}
	A\ar[r, "\varphi"]\ar[d] & B\ar[d]\\
	A_{\varphi^{-1}(p)}\ar[r, "\varphi_p"] & B_p.
\end{tikzcd}\]
Thus $\varphi_p^{-1}(pB_p) = \varphi^{-1}(p)A_{\varphi^{-1}(p)}$.
Given $V \subseteq \Spec A$ open, we may define
\begin{align*}
	f^\#_V\colon \mathcal{O}_{\Spec A}(V)&\to \mathcal{O}_{\Spec B}(f^{-1}(V))\\
	s&\mapsto (q\mapsto \varphi_q(s(f(q)))).
\end{align*}
We now have to check the local coherence condition of $\mathcal{O}$, i.e.,
if $s$ is locally given by $a/h$, then $f^\#_V(s)$ is locally given by
$\frac{\varphi(a)}{\varphi(h)}$ (this is obvious, but should be checked carefully).

This gives the desired map $f^\#\colon \mathcal{O}_{\Spec A}\to f_*\mathcal{O}_{\Spec B}$
and the induced map on stalks $f^\#_p\colon O_{\Spec A, f(p)}\to \mathcal{O}_{\Spec B, p}$
agrees with $\varphi_p\colon A_{\varphi^{-1}(p)}\to B_p$ by construction (this should
be checked carefully). Hence,
the pair $(f, f^\#)$ is a morphism of locally ringed spaces.

Now suppose given a morphism $(f, f^\#)\colon \Spec B\to \Spec A$ of locally
ringed spaces. We have
\[ f^\#_{\Spec A}\colon \Gamma(\Spec A, \mathcal{O}_{\Spec A}) \to \Gamma(\Spec B, \mathcal{O}_{\Spec B}), \]
but since the glocal sections of $\Spec R$ are just $R$, we get $\varphi\colon A\to B$.

We need to show that $\varphi$ gives rise to $(f, f^\#)$. We have a local homomorphism
\[ f_p^\#\colon A_{f(p)} \cong \mathcal{O}_{\Spec A, f(p)} \to \mathcal{O}_{\Spec B, p}\cong B_p. \]
This is compatible with the corresponding map on glocal sections in the sense that
\[\begin{tikzcd}
	\Gamma(\Spec A, \mathcal{O}_{\Spec A})\ar[d]\ar[r, "f^\#_{\Spec A}"] & \Gamma(\Spec B, \mathcal{O}_{\Spec B})\ar[d]\\
	\mathcal{O}_{\Spec A, f(p)}\ar[r, "f_p^\#"] & \mathcal{O}_{\Spec B, p}
\end{tikzcd}\]
is a commutative diagram. By applying our calculations, this yields a diagram
\[\begin{tikzcd}
	A\ar[r, "\varphi"]\ar[d] & B\ar[d]\\
	A_{f(p)}\ar[r, "f_p^\#"] & B_p.
\end{tikzcd}\]
Recall that $f_p^\#$ is a local homomorphism. Thus $(f_p^\#)^{-1}(pB_p) = f(p)A_{f(p)}	$.
Along the lower left path, the maximal ideal $pB_p$ is pulled back to $f(p)A_{f(p)}$ and
then to $f(p)$. Along the upper right path, it gets pulled back to $p$ and then to $\varphi^{-1}(p)$.
By commutativity, we conclude that $f(p) = \varphi^{-1}(p)$.

Thus $f$ is induced by $\varphi$ and by commutativity, $f_p^\# = \varphi_p$.
Then $f^\#$ is as constructed previously (this needs to be checked).
