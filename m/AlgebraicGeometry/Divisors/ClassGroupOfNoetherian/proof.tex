A UFD is integrally closed in its field of fractions (the argument is the same
as for $\mathbb{Z} \subseteq \mathbb{Q}$). Also $A$ is a UFD if and only if
every prime ideal of height $1$ of $A$ is principal (exercise).

Thus, we need to show that if $A$ is an integrally closed domain, we have the
equivalence: Every height $1$ prime of $A$ is principal if and only if
 $\Cl \Spec A = 0$.

First, assume that every height $1$ prime of $A$ is principal. Given a prime
divisor $Y \subseteq X$, $Y$ corresponds to a height $1$ prime $\mathfrak{p} \subseteq A$.
By assumption, this means that there is some $f \in A\setminus\set{0}$ such
that $\mathfrak{p} = (f)$, where $(f)$ is the ideal generated by $(f)$. Then
$(f) = 1\cdot Y$, where $(f)$ is the divisor of $f$. Hence, every divisor
in principal, i.e., $\Cl\Spec A = 0$.

Conversely, assume that every divisor in principal. Let $\mathfrak{p} \subseteq A$
be a prime of height $1$. Let $Y = V(\mathfrak{p})$. Then we find $f \in K(X)^\times = (A_{(0)})^\times$
such that $(f) = Y$, where $(f)$ is the divisor of $f$. Since $\nu_Y(f) = 1$,
we have $f \in A_{\mathfrak{p}} = \mathcal{O}_{X, \eta}$ and $f$ generates the
maximal ideal $\mathfrak{p}A_{\mathfrak{p}}$. Here we use that in a discrete
valuation rinh, every element of $\mathfrak{m}\setminus \mathfrak{m}^2$ generates
$\mathfrak{m}$ (exercise).

Further, if $\mathfrak{p}' \subseteq A$ is any other height $1$ prime, and $Y' = V(\mathfrak{p}')$,
then $\nu_{Y'}(f) = 0$, so $f \in A_{\mathfrak{p}'}$ is a unit. Now apply the following
result (e.g., from Matsumura, Commutative algebra, Theorem 38):

If $A$ is an integrally closed Noetherian domain, then
\[ A = \bigcap_{\hgt\mathfrak{p} = 1} A_{\mathfrak{p}} \subseteq A_{(0)}. \]

Thus, $f \in A$ and $f \in A\cap \mathfrak{p}A \mathfrak{p} = \mathfrak{p}$.
If we can show that $f$ generates $\mathfrak{p}$, we'll be done.

Let $g$ be any other element of $\mathfrak{p}$. Then $\nu_Y(g) \geq 1$ and
$\nu_{Y'}(g) \geq 0$ for all $Y'\neq Y$. In particular, $\nu_{Y'}(g/f) = \nu_{Y'}(g) - \nu_{Y'}(f)\geq 0$ for
all $Y'$. Thus $g/f \in A$. Thus $g = \frac{g}{f}\cdot f \in (f)$, where $(f)$ is
the ideal generated by $f$, so $p = (f)$ as required.
